#!/bin/ksh

set -eu

usage() {
	echo "usage: robsd-clean count" 1>&2
	exit 1
}

. "${EXECDIR:-/usr/local/libexec/robsd}/util.sh"

[ $# -eq 1 ] || usage

setmode "$(getmode "$0")"
setprogname "$(getmode "$0")-clean"
[ "$(id -u)" -ne 0 ] && fatal "must be run as root"
config_load "$(config_path)"

purge "$ROBSDDIR" "$1" | while read -r _d; do
	info "moving ${_d} to the attic"
done
