.Dd $Mdocdate: November 27 2018$
.Dt ROBSD 8
.Os
.Sh NAME
.Nm robsd
.Nd build OpenBSD release
.Sh SYNOPSIS
.Nm robsd
.Op Fl D
.Op Fl s Ar step
.Op Fl S Ar src-diff
.Op Fl X Ar xenocara-diff
.Nm
.Op Fl D
.Fl r Ar path
.Sh DESCRIPTION
The
.Nm
utility builds a
.Ox
release according to the
.Xr release 8
process.
Some steps are enhanced as follows:
.Bl -dash
.It
During step 2
.Pq Build and install a new kernel
the
.Pa GENERIC.MP
kernel is favored on multiprocessor machines based on
.Va hw.ncpu ,
see
.Xr sysctl 8 .
Otherwise,
the
.Pa GENERIC
kernel is used.
.El
.Pp
In addition, the following steps are also executed:
.Bl -dash
.It
After step 2
.Pq Build and install a new kernel
the machine is optionally rebooted.
Upon the next boot, the same release build is resumed from
.Xr rc.firsttime 8 .
.It
After step 8
.Pq Create boot and installation disk images
the final release files are optionally distributed to another host using
.Xr scp 1 .
.El
.Pp
Each release build is identified by a directory created by
.Nm
rooted in
.Ev BUILDDIR
and is named after the current date.
The release directory contains the entries as follows.
In addition, each executed step has a corresponding log file in the same
directory.
.Bl -tag -width Ds
.It Pa comment
File used to annotate the release build which is include in
.Pa report .
By default, it contains a list of all applied patches.
.It Pa rel
Directory containing the final release files.
Referred to as RELEASEDIR in
.Xr release 8 .
.It Pa report
A summary of the release build which is delivered as a mail to root once
.Nm
exits.
.It Pa robsd.log
Standard output and error from
.Nm
when running in detached mode.
.It Pa steps
Internal representation of the executed steps.
This file should never be edited manually.
.El
.Pp
.Nm
is configured using
.Xr robsd.conf 5
and must be run as root.
Some steps can however operate on behalf of another user using
.Xr su 1 ,
see
.Xr robsd.conf 5 .
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl D
Detach
.Nm
into the background.
.It Fl r Ar path
Resume a release build located at
.Ar path .
If the last executed step failed, it will be executed again.
Otherwise, the next step will be executed.
.It Fl s Ar step
Skip
.Ar step ,
see
.Xr robsd-steps 8
for a list of all available steps.
May be given multiple times.
.It Fl S Ar src-diff
Diff to apply to the src tree.
The same diff will be reverted once the release is finished.
In addition, a copy of the diff is saved to a file named
.Pa src.diff
in the release directory.
May be given multiple times.
.It Fl X Ar xenocara-diff
Diff to apply to the xenocara tree.
The same diff will be reverted once the release is finished.
In addition, a copy of the diff is saved to a file named
.Pa xenocara.diff
in the release directory.
May be given multiple times.
.El
.Sh FILES
.Bl -tag -width Ds
.It Pa /etc/robsd.conf
The default configuration file.
.El
.Sh DIAGNOSTICS
.Ex -std
.Sh SEE ALSO
.Xr robsd.conf 5 ,
.Xr release 8 ,
.Xr robsd-clean 8 ,
.Xr robsd-regress 8 ,
.Xr robsd-rescue 8 ,
.Xr robsd-steps 8
.Sh AUTHORS
.An Anton Lindqvist Aq Mt anton@basename.se
